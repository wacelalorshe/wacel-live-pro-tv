<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุฅุฏุงุฑุฉ ุงูุฅุดุนุงุฑุงุช - Aseel TV</title>
    
    <!-- CSS Libraries -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.0/css/line.css">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/admin.css">
    
    <style>
        /* ุฃููุงุท ุฅุถุงููุฉ ูุตูุญุฉ ุงูุฅุดุนุงุฑุงุช */
        .notification-edit-form {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            border: 1px solid #42318F;
            display: none;
        }
        
        .notification-edit-form.show {
            display: block;
            animation: slideDown 0.3s ease;
        }
        
        .notification-actions {
            display: flex;
            gap: 5px;
        }
        
        .notification-actions .btn-sm {
            padding: 4px 8px;
            font-size: 12px;
        }
        
        .bulk-actions {
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid #42318F;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            display: none;
        }
        
        .bulk-actions.show {
            display: block;
        }
        
        .selected-count {
            background: #322769;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 12px;
            margin-right: 5px;
        }
        
        .notification-checkbox {
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <!-- ุงูุชุญูู ูู ุตูุงุญูุงุช ุงูุฏุฎูู -->
        <div id="authCheck" class="auth-required" style="display: none;">
            <div class="mb-4">
                <i class="uil uil-lock-alt" style="font-size: 80px; color: #FF5200;"></i>
            </div>
            <h3 class="text-white mb-3">ูุฌุจ ุชุณุฌูู ุงูุฏุฎูู ุฃููุงู</h3>
            <p class="text-white mb-4" style="font-size: 18px;">ูุฌุจ ุฃู ุชููู ูุดุฑูุงู ูููุตูู ุฅูู ูุฐู ุงูุตูุญุฉ</p>
            <a href="index.html" class="btn btn-primary btn-lg">
                <i class="uil uil-signin"></i> ุงูุนูุฏุฉ ููุตูุญุฉ ุงูุฑุฆูุณูุฉ
            </a>
        </div>

        <!-- ููุญุฉ ุฅุฏุงุฑุฉ ุงูุฅุดุนุงุฑุงุช -->
        <div id="notificationsPanel" style="display: none;">
            <div class="text-center mb-5">
                <h1 style="color: #E1E1E1; text-shadow: 0 2px 4px rgba(0,0,0,0.5); font-size: 2.5rem;">
                    <i class="uil uil-bell"></i> ุฅุฏุงุฑุฉ ุงูุฅุดุนุงุฑุงุช
                </h1>
                <p class="text-muted">ุนุฑุถ ูุชุนุฏูู ูุญุฐู ุงูุฅุดุนุงุฑุงุช ุงููุฑุณูุฉ</p>
            </div>

            <!-- ุฅุญุตุงุฆูุงุช ุงูุฅุดุนุงุฑุงุช -->
            <div class="row mb-4">
                <div class="col-md-3">
                    <div class="stats-card">
                        <div class="stats-number" id="totalNotifications">0</div>
                        <div class="stats-label">ุฅุฌูุงูู ุงูุฅุดุนุงุฑุงุช</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stats-card">
                        <div class="stats-number" id="unreadNotifications">0</div>
                        <div class="stats-label">ุบูุฑ ููุฑูุกุฉ</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stats-card">
                        <div class="stats-number" id="todayNotifications">0</div>
                        <div class="stats-label">ุงูููู</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stats-card">
                        <div class="stats-number" id="activeNotifications">0</div>
                        <div class="stats-label">ูุดุทุฉ</div>
                    </div>
                </div>
            </div>

            <!-- ุฅุฌุฑุงุกุงุช ุณุฑูุนุฉ -->
            <div class="sync-actions mb-4">
                <h5 class="text-white mb-3"><i class="uil uil-cog"></i> ุฅุฌุฑุงุกุงุช ุณุฑูุนุฉ</h5>
                <div class="row">
                    <div class="col-md-2">
                        <button class="btn btn-success w-100 mb-2" onclick="loadNotifications()">
                            <i class="uil uil-refresh"></i> ุชุญุฏูุซ
                        </button>
                    </div>
                    <div class="col-md-2">
                        <button class="btn btn-info w-100 mb-2" onclick="toggleBulkActions()">
                            <i class="uil uil-check-square"></i> ุชุญุฏูุฏ ูุชุนุฏุฏ
                        </button>
                    </div>
                    <div class="col-md-2">
                        <button class="btn btn-primary w-100 mb-2" onclick="markAllAsRead()">
                            <i class="uil uil-check-circle"></i> ุชุญุฏูุฏ ูููุฑูุก
                        </button>
                    </div>
                    <div class="col-md-2">
                        <button class="btn btn-warning w-100 mb-2" onclick="exportNotifications()">
                            <i class="uil uil-import"></i> ุชุตุฏูุฑ
                        </button>
                    </div>
                    <div class="col-md-2">
                        <button class="btn btn-danger w-100 mb-2" onclick="showDeleteAllModal()">
                            <i class="uil uil-trash-alt"></i> ุญุฐู ุงูุฌููุน
                        </button>
                    </div>
                    <div class="col-md-2">
                        <a href="message-sender.html" class="btn btn-secondary w-100 mb-2">
                            <i class="uil uil-megaphone"></i> ุฅุฑุณุงู ุฌุฏูุฏ
                        </a>
                    </div>
                </div>
            </div>

            <!-- ุฅุฌุฑุงุกุงุช ุงููุฌููุนุฉ -->
            <div id="bulkActions" class="bulk-actions">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <span class="selected-count" id="selectedCount">0</span>
                        <span class="text-white">ุฅุดุนุงุฑ ูุญุฏุฏ</span>
                    </div>
                    <div class="notification-actions">
                        <button class="btn btn-sm btn-info" onclick="markSelectedAsRead()">
                            <i class="uil uil-check-circle"></i> ุชุญุฏูุฏ ูููุฑูุก
                        </button>
                        <button class="btn btn-sm btn-warning" onclick="markSelectedAsUnread()">
                            <i class="uil uil-eye-slash"></i> ุชุญุฏูุฏ ูุบูุฑ ููุฑูุก
                        </button>
                        <button class="btn btn-sm btn-success" onclick="activateSelected()">
                            <i class="uil uil-power"></i> ุชูุนูู
                        </button>
                        <button class="btn btn-sm btn-secondary" onclick="deactivateSelected()">
                            <i class="uil uil-power"></i> ุชุนุทูู
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteSelected()">
                            <i class="uil uil-trash-alt"></i> ุญุฐู ุงููุญุฏุฏ
                        </button>
                        <button class="btn btn-sm btn-outline-light" onclick="deselectAll()">
                            <i class="uil uil-times"></i> ุฅูุบุงุก ุงูุชุญุฏูุฏ
                        </button>
                    </div>
                </div>
            </div>

            <!-- ููุชุฑุฉ ุงูุฅุดุนุงุฑุงุช -->
            <div class="card mb-4" style="background: rgba(0,0,0,0.7); border: 1px solid #42318F;">
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3">
                            <input type="text" class="form-control" id="searchNotifications" 
                                   placeholder="๐ ุจุญุซ ูู ุงูุฅุดุนุงุฑุงุช..." oninput="filterNotifications()">
                        </div>
                        <div class="col-md-2">
                            <select class="form-control" id="filterType" onchange="filterNotifications()">
                                <option value="">ุฌููุน ุงูุฃููุงุน</option>
                                <option value="info">ูุนูููุงุช</option>
                                <option value="warning">ุชุญุฐูุฑ</option>
                                <option value="important">ูุงู</option>
                                <option value="success">ูุฌุงุญ</option>
                                <option value="welcome">ุชุฑุญูุจ</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <select class="form-control" id="filterStatus" onchange="filterNotifications()">
                                <option value="">ุฌููุน ุงูุญุงูุงุช</option>
                                <option value="unread">ุบูุฑ ููุฑูุก</option>
                                <option value="read">ููุฑูุก</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <select class="form-control" id="filterActivity" onchange="filterNotifications()">
                                <option value="">ุงููุดุงุท</option>
                                <option value="active">ูุดุท</option>
                                <option value="inactive">ุบูุฑ ูุดุท</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <select class="form-control" id="filterDate" onchange="filterNotifications()">
                                <option value="">ุฌููุน ุงูุฃููุงุช</option>
                                <option value="today">ุงูููู</option>
                                <option value="week">ูุฐุง ุงูุฃุณุจูุน</option>
                                <option value="month">ูุฐุง ุงูุดูุฑ</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ูุงุฆูุฉ ุงูุฅุดุนุงุฑุงุช -->
            <div class="card" style="background: rgba(0,0,0,0.7); border: 1px solid #42318F;">
                <div class="card-header card-header-custom d-flex justify-content-between align-items-center">
                    <h4 class="mb-0 text-white">
                        <i class="uil uil-list-ul"></i> ูุงุฆูุฉ ุงูุฅุดุนุงุฑุงุช
                        <span class="badge bg-primary ms-2" id="notificationsCount">0</span>
                    </h4>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" id="selectAllNotifications" onchange="toggleSelectAll(this.checked)">
                        <label class="form-check-label text-white" for="selectAllNotifications">ุชุญุฏูุฏ ุงููู</label>
                    </div>
                </div>
                <div class="card-body">
                    <div id="notificationsList">
                        <div class="text-center py-5">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">ุฌุงุฑู ุงูุชุญููู...</span>
                            </div>
                            <p class="mt-3 text-muted">ุฌุงุฑู ุชุญููู ุงูุฅุดุนุงุฑุงุช...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ูููุฐุฌ ุชุนุฏูู ุงูุฅุดุนุงุฑ -->
            <div class="card mt-4" style="background: rgba(0,0,0,0.7); border: 1px solid #42318F; display: none;" id="editFormCard">
                <div class="card-header card-header-custom">
                    <h4 class="mb-0 text-white">
                        <i class="uil uil-edit"></i> ุชุนุฏูู ุงูุฅุดุนุงุฑ
                    </h4>
                </div>
                <div class="card-body">
                    <form id="editNotificationForm" onsubmit="updateNotification(event)">
                        <input type="hidden" id="editNotificationId">
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label class="form-label">ุนููุงู ุงูุฅุดุนุงุฑ *</label>
                                    <input type="text" id="editTitle" class="form-control" required>
                                </div>
                                <div class="form-group mb-3">
                                    <label class="form-label">ููุน ุงูุฅุดุนุงุฑ</label>
                                    <select id="editType" class="form-control">
                                        <option value="info">ูุนูููุงุช</option>
                                        <option value="warning">ุชุญุฐูุฑ</option>
                                        <option value="important">ูุงู</option>
                                        <option value="success">ูุฌุงุญ</option>
                                        <option value="welcome">ุชุฑุญูุจ</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label class="form-label">ุงูุฃููููุฉ</label>
                                    <select id="editPriority" class="form-control">
                                        <option value="normal">ุนุงุฏูุฉ</option>
                                        <option value="high">ุนุงููุฉ</option>
                                        <option value="urgent">ุนุงุฌูุฉ</option>
                                    </select>
                                </div>
                                <div class="form-group mb-3">
                                    <label class="form-label">ุงูุญุงูุฉ</label>
                                    <div class="d-flex gap-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="editIsActive">
                                            <label class="form-check-label" for="editIsActive">
                                                ูุดุท
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="editIsRead">
                                            <label class="form-check-label" for="editIsRead">
                                                ููุฑูุก
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group mb-3">
                            <label class="form-label">ูุต ุงูุฑุณุงูุฉ *</label>
                            <textarea id="editMessage" class="form-control" rows="4" required></textarea>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-8">
                                <div class="form-group mb-3">
                                    <label class="form-label">ุฑุงุจุท ุงูุฅุฌุฑุงุก (ุงุฎุชูุงุฑู)</label>
                                    <input type="url" id="editActionUrl" class="form-control">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group mb-3">
                                    <label class="form-label">ูุต ุงูุฑุงุจุท</label>
                                    <input type="text" id="editLinkText" class="form-control" value="ุนุฑุถ ุงูุชูุงุตูู">
                                </div>
                            </div>
                        </div>
                        
                        <div class="d-flex gap-2">
                            <button type="submit" class="btn btn-success flex-fill">
                                <i class="uil uil-save"></i> ุญูุธ ุงูุชุบููุฑุงุช
                            </button>
                            <button type="button" class="btn btn-secondary" onclick="cancelEdit()">
                                <i class="uil uil-times"></i> ุฅูุบุงุก
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- ุฃุฒุฑุงุฑ ุงูุชููู -->
            <div class="mt-5 text-center">
                <a href="message-sender.html" class="btn btn-success me-3">
                    <i class="uil uil-megaphone"></i> ุฅุฑุณุงู ุฅุดุนุงุฑ ุฌุฏูุฏ
                </a>
                <a href="admin.html" class="btn btn-primary me-3">
                    <i class="uil uil-arrow-left"></i> ุงูุนูุฏุฉ ููุฅุฏุงุฑุฉ
                </a>
                <a href="index.html" class="btn btn-secondary">
                    <i class="uil uil-home"></i> ุงูุฑุฆูุณูุฉ
                </a>
            </div>
        </div>
    </div>

    <!-- Modal ุญุฐู ุฌููุน ุงูุฅุดุนุงุฑุงุช -->
    <div class="modal fade" id="deleteAllModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content" style="background: rgba(0,0,0,0.9); border: 2px solid #42318F;">
                <div class="modal-header border-0">
                    <h5 class="modal-title text-white">
                        <i class="uil uil-trash-alt text-danger me-2"></i>
                        ุญุฐู ุฌููุน ุงูุฅุดุนุงุฑุงุช
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="text-center mb-4">
                        <i class="uil uil-exclamation-triangle" style="font-size: 60px; color: #ffc107;"></i>
                    </div>
                    <h5 class="text-center text-warning mb-3">โ๏ธ ุชุญุฐูุฑ ููู!</h5>
                    <p class="text-white text-center">
                        ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู <strong>ุฌููุน ุงูุฅุดุนุงุฑุงุช</strong>ุ
                    </p>
                    <p class="text-muted text-center">
                        ูุฐุง ุงูุฅุฌุฑุงุก ูุง ูููู ุงูุชุฑุงุฌุน ุนูู ูุณูุชู ุญุฐู ุฌููุน ุงูุฅุดุนุงุฑุงุช ููุงุฆูุงู.
                    </p>
                    <div class="alert alert-danger mt-3">
                        <i class="uil uil-info-circle"></i>
                        ุณูุชู ุญุฐู <strong><span id="deleteAllCount">0</span></strong> ุฅุดุนุงุฑ
                    </div>
                </div>
                <div class="modal-footer border-0">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="uil uil-times"></i> ุฅูุบุงุก
                    </button>
                    <button type="button" class="btn btn-danger" onclick="deleteAllNotifications()">
                        <i class="uil uil-trash-alt"></i> ูุนูุ ุงุญุฐู ุงููู
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal ุญุฐู ุฅุดุนุงุฑ ูุญุฏุฏ -->
    <div class="modal fade" id="deleteSelectedModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content" style="background: rgba(0,0,0,0.9); border: 2px solid #42318F;">
                <div class="modal-header border-0">
                    <h5 class="modal-title text-white">
                        <i class="uil uil-trash-alt text-danger me-2"></i>
                        ุญุฐู ุงูุฅุดุนุงุฑุงุช ุงููุญุฏุฏุฉ
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="text-center mb-4">
                        <i class="uil uil-trash-alt" style="font-size: 60px; color: #dc3545;"></i>
                    </div>
                    <p class="text-white text-center">
                        ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู <strong><span id="deleteSelectedCount">0</span></strong> ุฅุดุนุงุฑุ
                    </p>
                    <p class="text-muted text-center">
                        ุณูุชู ุญุฐู ุงูุฅุดุนุงุฑุงุช ุงููุญุฏุฏุฉ ููุงุฆูุงู ููุง ูููู ุงุณุชุนุงุฏุชูุง.
                    </p>
                </div>
                <div class="modal-footer border-0">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="uil uil-times"></i> ุฅูุบุงุก
                    </button>
                    <button type="button" class="btn btn-danger" onclick="confirmDeleteSelected()">
                        <i class="uil uil-trash-alt"></i> ูุนูุ ุงุญุฐู ุงููุญุฏุฏ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        let allNotifications = [];
        let filteredNotifications = [];
        let selectedNotifications = new Set();
        let db = null;
        let editMode = false;

        // ุงูุชุญูู ูู ุตูุงุญูุงุช ุงููุดุฑู
        function checkAdminAuth() {
            const authCheck = document.getElementById('authCheck');
            const notificationsPanel = document.getElementById('notificationsPanel');
            
            const isAuthenticated = localStorage.getItem('adminAuth') === 'true';
            
            if (isAuthenticated) {
                authCheck.style.display = 'none';
                notificationsPanel.style.display = 'block';
                initializeFirebase();
            } else {
                authCheck.style.display = 'block';
                notificationsPanel.style.display = 'none';
            }
        }

        // ุชููุฆุฉ Firebase
        async function initializeFirebase() {
            try {
                if (typeof firebase === 'undefined') {
                    throw new Error('Firebase ุบูุฑ ูุชุงุญ');
                }

                // ุชูููู Firebase
                const firebaseConfig = {
                    apiKey: "AIzaSyAkgEiYYlmpMe0NLewulheovlTQMz5C980",
                    authDomain: "bein-42f9e.firebaseapp.com",
                    projectId: "bein-42f9e",
                    storageBucket: "bein-42f9e.firebasestorage.app",
                    messagingSenderId: "143741167050",
                    appId: "1:143741167050:web:922d3a0cddb40f67b21b33",
                    measurementId: "G-JH198SKCFS"
                };

                // ุชููุฆุฉ Firebase
                if (!firebase.apps.length) {
                    firebase.initializeApp(firebaseConfig);
                }
                
                db = firebase.firestore();
                
                // ุชุญููู ุงูุฅุดุนุงุฑุงุช
                await loadNotifications();
                
            } catch (error) {
                console.error('โ ูุดู ุชููุฆุฉ Firebase:', error);
                showError('ูุดู ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช');
            }
        }

        // ุชุญููู ุงูุฅุดุนุงุฑุงุช
        async function loadNotifications() {
            try {
                showLoading(true);
                
                if (!db) {
                    throw new Error('ูุงุนุฏุฉ ุงูุจูุงูุงุช ุบูุฑ ูุชุงุญุฉ');
                }

                const snapshot = await db.collection('notifications')
                    .orderBy('createdAt', 'desc')
                    .get();

                allNotifications = [];
                snapshot.forEach(doc => {
                    const data = doc.data();
                    allNotifications.push({
                        id: doc.id,
                        title: data.title || 'ุจุฏูู ุนููุงู',
                        message: data.message || '',
                        type: data.type || 'info',
                        createdAt: data.createdAt || new Date(),
                        isRead: data.isRead || false,
                        isActive: data.isActive !== false,
                        actionUrl: data.actionUrl,
                        linkText: data.linkText || 'ุนุฑุถ ุงูุชูุงุตูู',
                        sender: data.sender || 'admin',
                        priority: data.priority || 'normal'
                    });
                });

                filteredNotifications = [...allNotifications];
                renderNotifications();
                updateStatistics();
                
                showLoading(false);
                showSuccess('ุชู ุชุญููู ุงูุฅุดุนุงุฑุงุช ุจูุฌุงุญ');
                
            } catch (error) {
                console.error('โ ุฎุทุฃ ูู ุชุญููู ุงูุฅุดุนุงุฑุงุช:', error);
                showError('ูุดู ุชุญููู ุงูุฅุดุนุงุฑุงุช: ' + error.message);
                showLoading(false);
            }
        }

        // ุนุฑุถ ุญุงูุฉ ุงูุชุญููู
        function showLoading(show) {
            const container = document.getElementById('notificationsList');
            if (!container) return;
            
            if (show) {
                container.innerHTML = `
                    <div class="text-center py-5">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">ุฌุงุฑู ุงูุชุญููู...</span>
                        </div>
                        <p class="mt-3 text-muted">ุฌุงุฑู ุชุญููู ุงูุฅุดุนุงุฑุงุช...</p>
                    </div>
                `;
            }
        }

        // ุนุฑุถ ุงูุฅุดุนุงุฑุงุช
        function renderNotifications() {
            const container = document.getElementById('notificationsList');
            const countElement = document.getElementById('notificationsCount');
            
            if (!container) return;
            
            if (filteredNotifications.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-5">
                        <i class="uil uil-bell-slash" style="font-size: 60px; color: #666;"></i>
                        <h5 class="mt-3 text-muted">ูุง ุชูุฌุฏ ุฅุดุนุงุฑุงุช</h5>
                        <button class="btn btn-primary mt-3" onclick="loadNotifications()">
                            <i class="uil uil-refresh"></i> ุฅุนุงุฏุฉ ุงูุชุญููู
                        </button>
                    </div>
                `;
                if (countElement) countElement.textContent = '0';
                return;
            }
            
            const icons = {
                info: 'uil uil-info-circle text-info',
                warning: 'uil uil-exclamation-triangle text-warning',
                important: 'uil uil-bell text-danger',
                success: 'uil uil-check-circle text-success',
                welcome: 'uil uil-smile text-primary'
            };
            
            container.innerHTML = filteredNotifications.map(notification => {
                const date = notification.createdAt.toDate ? 
                    notification.createdAt.toDate() : new Date(notification.createdAt);
                const timeString = date.toLocaleTimeString('ar-SA');
                const dateString = date.toLocaleDateString('ar-SA');
                const isSelected = selectedNotifications.has(notification.id);
                
                return `
                    <div class="notification-item ${notification.isRead ? 'read' : 'unread'} mb-3" id="notification-${notification.id}">
                        <div class="d-flex justify-content-between align-items-start">
                            <div class="d-flex align-items-start" style="flex: 1;">
                                <div class="notification-checkbox">
                                    <input type="checkbox" class="form-check-input" 
                                           ${isSelected ? 'checked' : ''}
                                           onchange="toggleNotificationSelection('${notification.id}', this.checked)">
                                </div>
                                <div class="notification-icon me-3">
                                    <i class="${icons[notification.type] || 'uil uil-bell'}"></i>
                                </div>
                                <div style="flex: 1;">
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <h6 class="text-white mb-0">${notification.title}</h6>
                                        <div>
                                            <span class="badge ${notification.isActive ? 'bg-success' : 'bg-secondary'} me-2">
                                                ${notification.isActive ? 'ูุดุท' : 'ุบูุฑ ูุดุท'}
                                            </span>
                                            <span class="badge bg-info">
                                                ${notification.priority === 'urgent' ? 'ุนุงุฌู' : 
                                                  notification.priority === 'high' ? 'ูุฑุชูุน' : 'ุนุงุฏู'}
                                            </span>
                                        </div>
                                    </div>
                                    <p class="text-muted mb-2">${notification.message}</p>
                                    <div class="text-muted small">
                                        <i class="uil uil-user"></i> ${notification.sender}
                                        <span class="mx-2">โข</span>
                                        <i class="uil uil-calendar-alt"></i> ${dateString}
                                        <span class="mx-2">โข</span>
                                        <i class="uil uil-clock"></i> ${timeString}
                                        ${notification.actionUrl ? `
                                            <span class="mx-2">โข</span>
                                            <a href="${notification.actionUrl}" target="_blank" class="text-info">
                                                <i class="uil uil-external-link-alt"></i> ${notification.linkText}
                                            </a>
                                        ` : ''}
                                    </div>
                                </div>
                            </div>
                            <div class="notification-actions">
                                <button class="btn btn-warning btn-sm" onclick="editNotification('${notification.id}')" title="ุชุนุฏูู">
                                    <i class="uil uil-edit"></i>
                                </button>
                                <button class="btn btn-danger btn-sm ms-1" onclick="showDeleteModal('${notification.id}')" title="ุญุฐู">
                                    <i class="uil uil-trash-alt"></i>
                                </button>
                            </div>
                        </div>
                        <!-- ูููุฐุฌ ุงูุชุนุฏูู ุงููุถูู -->
                        <div class="notification-edit-form" id="edit-form-${notification.id}"></div>
                    </div>
                `;
            }).join('');
            
            if (countElement) countElement.textContent = filteredNotifications.length;
            
            // ุชุญุฏูุซ ุนุฏุฏ ุงูุฅุดุนุงุฑุงุช ุงููุญุฏุฏุฉ
            updateSelectedCount();
        }

        // ุชุญุฏูุซ ุงูุฅุญุตุงุฆูุงุช
        function updateStatistics() {
            const total = allNotifications.length;
            const unread = allNotifications.filter(n => !n.isRead).length;
            const today = allNotifications.filter(n => {
                const date = n.createdAt.toDate ? n.createdAt.toDate() : new Date(n.createdAt);
                const today = new Date();
                return date.toDateString() === today.toDateString();
            }).length;
            const active = allNotifications.filter(n => n.isActive).length;
            
            document.getElementById('totalNotifications').textContent = total;
            document.getElementById('unreadNotifications').textContent = unread;
            document.getElementById('todayNotifications').textContent = today;
            document.getElementById('activeNotifications').textContent = active;
            
            // ุชุญุฏูุซ ุนุฏุฏ ุงูุฅุดุนุงุฑุงุช ูุญุฐู ุงููู
            document.getElementById('deleteAllCount').textContent = total;
        }

        // ููุชุฑุฉ ุงูุฅุดุนุงุฑุงุช
        function filterNotifications() {
            const searchTerm = document.getElementById('searchNotifications').value.toLowerCase();
            const typeFilter = document.getElementById('filterType').value;
            const statusFilter = document.getElementById('filterStatus').value;
            const activityFilter = document.getElementById('filterActivity').value;
            const dateFilter = document.getElementById('filterDate').value;
            
            filteredNotifications = allNotifications.filter(notification => {
                // ุงูุจุญุซ ุงููุตู
                if (searchTerm && !notification.title.toLowerCase().includes(searchTerm) && 
                    !notification.message.toLowerCase().includes(searchTerm) &&
                    !notification.sender.toLowerCase().includes(searchTerm)) {
                    return false;
                }
                
                // ููุชุฑุฉ ุงูููุน
                if (typeFilter && notification.type !== typeFilter) {
                    return false;
                }
                
                // ููุชุฑุฉ ุญุงูุฉ ุงููุฑุงุกุฉ
                if (statusFilter === 'unread' && notification.isRead) {
                    return false;
                }
                if (statusFilter === 'read' && !notification.isRead) {
                    return false;
                }
                
                // ููุชุฑุฉ ุงููุดุงุท
                if (activityFilter === 'active' && !notification.isActive) {
                    return false;
                }
                if (activityFilter === 'inactive' && notification.isActive) {
                    return false;
                }
                
                // ููุชุฑุฉ ุงูุชุงุฑูุฎ
                if (dateFilter) {
                    const date = notification.createdAt.toDate ? 
                        notification.createdAt.toDate() : new Date(notification.createdAt);
                    const today = new Date();
                    
                    if (dateFilter === 'today') {
                        if (date.toDateString() !== today.toDateString()) return false;
                    } else if (dateFilter === 'week') {
                        const weekAgo = new Date();
                        weekAgo.setDate(today.getDate() - 7);
                        if (date < weekAgo) return false;
                    } else if (dateFilter === 'month') {
                        const monthAgo = new Date();
                        monthAgo.setMonth(today.getMonth() - 1);
                        if (date < monthAgo) return false;
                    }
                }
                
                return true;
            });
            
            renderNotifications();
        }

        // ุงูุชุจุฏูู ุจูู ุชุญุฏูุฏ/ุฅูุบุงุก ุชุญุฏูุฏ ุงูุฅุดุนุงุฑ
        function toggleNotificationSelection(notificationId, isSelected) {
            if (isSelected) {
                selectedNotifications.add(notificationId);
            } else {
                selectedNotifications.delete(notificationId);
            }
            
            updateSelectedCount();
            
            // ุชุญุฏูุซ ุญุงูุฉ ุชุญุฏูุฏ ุงููู
            const selectAllCheckbox = document.getElementById('selectAllNotifications');
            if (selectAllCheckbox) {
                selectAllCheckbox.checked = selectedNotifications.size === filteredNotifications.length;
            }
        }

        // ุชุญุฏูุฏ/ุฅูุบุงุก ุชุญุฏูุฏ ุงููู
        function toggleSelectAll(isSelected) {
            if (isSelected) {
                filteredNotifications.forEach(notification => {
                    selectedNotifications.add(notification.id);
                });
            } else {
                filteredNotifications.forEach(notification => {
                    selectedNotifications.delete(notification.id);
                });
            }
            
            renderNotifications();
        }

        // ุฅูุบุงุก ุชุญุฏูุฏ ุงููู
        function deselectAll() {
            selectedNotifications.clear();
            renderNotifications();
        }

        // ุชุญุฏูุซ ุนุฏุฏ ุงูุฅุดุนุงุฑุงุช ุงููุญุฏุฏุฉ
        function updateSelectedCount() {
            const selectedCount = selectedNotifications.size;
            document.getElementById('selectedCount').textContent = selectedCount;
            
            // ุฅุธูุงุฑ/ุฅุฎูุงุก ูุณู ุงูุฅุฌุฑุงุกุงุช ุงููุฌูุนุฉ
            const bulkActions = document.getElementById('bulkActions');
            if (bulkActions) {
                if (selectedCount > 0) {
                    bulkActions.classList.add('show');
                } else {
                    bulkActions.classList.remove('show');
                }
            }
            
            // ุชุญุฏูุซ ุนุฏุฏ ุงูุฅุดุนุงุฑุงุช ุงููุญุฏุฏุฉ ูู ุงูููุฏุงู
            document.getElementById('deleteSelectedCount').textContent = selectedCount;
        }

        // ุฅุธูุงุฑ/ุฅุฎูุงุก ุฅุฌุฑุงุกุงุช ุงููุฌููุนุฉ
        function toggleBulkActions() {
            const bulkActions = document.getElementById('bulkActions');
            if (bulkActions) {
                if (bulkActions.classList.contains('show')) {
                    selectedNotifications.clear();
                    renderNotifications();
                } else {
                    // ุชุญุฏูุฏ ุฌููุน ุงูุฅุดุนุงุฑุงุช ุงููุฑุฆูุฉ
                    filteredNotifications.forEach(notification => {
                        selectedNotifications.add(notification.id);
                    });
                    renderNotifications();
                }
            }
        }

        // ุชุนุฏูู ุงูุฅุดุนุงุฑ
        function editNotification(notificationId) {
            // ุฅุฎูุงุก ุฃู ูููุฐุฌ ุชุนุฏูู ููุชูุญ
            document.querySelectorAll('.notification-edit-form').forEach(form => {
                form.classList.remove('show');
            });
            
            // ุฅุธูุงุฑ ูููุฐุฌ ุงูุชุนุฏูู ุงูุฑุฆูุณู
            const notification = allNotifications.find(n => n.id === notificationId);
            if (!notification) return;
            
            document.getElementById('editNotificationId').value = notification.id;
            document.getElementById('editTitle').value = notification.title;
            document.getElementById('editMessage').value = notification.message;
            document.getElementById('editType').value = notification.type;
            document.getElementById('editPriority').value = notification.priority;
            document.getElementById('editIsActive').checked = notification.isActive;
            document.getElementById('editIsRead').checked = notification.isRead;
            document.getElementById('editActionUrl').value = notification.actionUrl || '';
            document.getElementById('editLinkText').value = notification.linkText || 'ุนุฑุถ ุงูุชูุงุตูู';
            
            // ุฅุธูุงุฑ ูููุฐุฌ ุงูุชุนุฏูู
            const editFormCard = document.getElementById('editFormCard');
            editFormCard.style.display = 'block';
            editFormCard.scrollIntoView({ behavior: 'smooth' });
            
            editMode = true;
        }

        // ุชุญุฏูุซ ุงูุฅุดุนุงุฑ
        async function updateNotification(event) {
            event.preventDefault();
            
            const notificationId = document.getElementById('editNotificationId').value;
            const notificationData = {
                title: document.getElementById('editTitle').value.trim(),
                message: document.getElementById('editMessage').value.trim(),
                type: document.getElementById('editType').value,
                priority: document.getElementById('editPriority').value,
                isActive: document.getElementById('editIsActive').checked,
                isRead: document.getElementById('editIsRead').checked,
                actionUrl: document.getElementById('editActionUrl').value.trim() || null,
                linkText: document.getElementById('editLinkText').value.trim() || 'ุนุฑุถ ุงูุชูุงุตูู',
                updatedAt: new Date()
            };
            
            if (!notificationData.title || !notificationData.message) {
                showError('ูุฑุฌู ููุก ุฌููุน ุงูุญููู ุงููุทููุจุฉ');
                return;
            }
            
            try {
                if (!db) throw new Error('ูุงุนุฏุฉ ุงูุจูุงูุงุช ุบูุฑ ูุชุงุญุฉ');
                
                await db.collection('notifications').doc(notificationId).update(notificationData);
                
                // ุชุญุฏูุซ ูุญููุงู
                const notificationIndex = allNotifications.findIndex(n => n.id === notificationId);
                if (notificationIndex !== -1) {
                    allNotifications[notificationIndex] = {
                        ...allNotifications[notificationIndex],
                        ...notificationData
                    };
                }
                
                // ุชุญุฏูุซ ุงููุงุฌูุฉ
                renderNotifications();
                updateStatistics();
                
                // ุฅุฎูุงุก ูููุฐุฌ ุงูุชุนุฏูู
                cancelEdit();
                
                showSuccess('ุชู ุชุญุฏูุซ ุงูุฅุดุนุงุฑ ุจูุฌุงุญ');
                
            } catch (error) {
                console.error('โ ุฎุทุฃ ูู ุชุญุฏูุซ ุงูุฅุดุนุงุฑ:', error);
                showError('ูุดู ุชุญุฏูุซ ุงูุฅุดุนุงุฑ: ' + error.message);
            }
        }

        // ุฅูุบุงุก ุงูุชุนุฏูู
        function cancelEdit() {
            document.getElementById('editNotificationForm').reset();
            document.getElementById('editFormCard').style.display = 'none';
            editMode = false;
        }

        // ุนุฑุถ ููุฏุงู ุญุฐู ุฅุดุนุงุฑ ูุงุญุฏ
        function showDeleteModal(notificationId) {
            const notification = allNotifications.find(n => n.id === notificationId);
            if (!notification) return;
            
            if (confirm(`ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ุงูุฅุดุนุงุฑ "${notification.title}"ุ`)) {
                deleteSingleNotification(notificationId);
            }
        }

        // ุญุฐู ุฅุดุนุงุฑ ูุงุญุฏ
        async function deleteSingleNotification(notificationId) {
            try {
                if (!db) throw new Error('ูุงุนุฏุฉ ุงูุจูุงูุงุช ุบูุฑ ูุชุงุญุฉ');
                
                await db.collection('notifications').doc(notificationId).delete();
                
                // ุชุญุฏูุซ ูุญููุงู
                allNotifications = allNotifications.filter(n => n.id !== notificationId);
                filteredNotifications = filteredNotifications.filter(n => n.id !== notificationId);
                selectedNotifications.delete(notificationId);
                
                // ุชุญุฏูุซ ุงููุงุฌูุฉ
                renderNotifications();
                updateStatistics();
                
                showSuccess('ุชู ุญุฐู ุงูุฅุดุนุงุฑ ุจูุฌุงุญ');
                
            } catch (error) {
                console.error('โ ุฎุทุฃ ูู ุญุฐู ุงูุฅุดุนุงุฑ:', error);
                showError('ูุดู ุญุฐู ุงูุฅุดุนุงุฑ: ' + error.message);
            }
        }

        // ุญุฐู ุงูุฅุดุนุงุฑุงุช ุงููุญุฏุฏุฉ
        async function deleteSelected() {
            if (selectedNotifications.size === 0) {
                showInfo('ูู ูุชู ุชุญุฏูุฏ ุฃู ุฅุดุนุงุฑุงุช ููุญุฐู');
                return;
            }
            
            // ุนุฑุถ ููุฏุงู ุงูุชุฃููุฏ ุจุงุณุชุฎุฏุงู Bootstrap
            const deleteSelectedModal = new bootstrap.Modal(document.getElementById('deleteSelectedModal'));
            deleteSelectedModal.show();
        }

        // ุชุฃููุฏ ุญุฐู ุงูุฅุดุนุงุฑุงุช ุงููุญุฏุฏุฉ
        async function confirmDeleteSelected() {
            try {
                if (!db) throw new Error('ูุงุนุฏุฉ ุงูุจูุงูุงุช ุบูุฑ ูุชุงุญุฉ');
                
                // ุฅุบูุงู ุงูููุฏุงู
                const deleteSelectedModal = bootstrap.Modal.getInstance(document.getElementById('deleteSelectedModal'));
                deleteSelectedModal.hide();
                
                showLoading(true);
                
                // ุญุฐู ูู Firebase
                const batch = db.batch();
                selectedNotifications.forEach(notificationId => {
                    const ref = db.collection('notifications').doc(notificationId);
                    batch.delete(ref);
                });
                
                await batch.commit();
                
                // ุชุญุฏูุซ ูุญููุงู
                allNotifications = allNotifications.filter(n => !selectedNotifications.has(n.id));
                filteredNotifications = filteredNotifications.filter(n => !selectedNotifications.has(n.id));
                selectedNotifications.clear();
                
                // ุชุญุฏูุซ ุงููุงุฌูุฉ
                renderNotifications();
                updateStatistics();
                
                showLoading(false);
                showSuccess(`ุชู ุญุฐู ${selectedNotifications.size} ุฅุดุนุงุฑ ุจูุฌุงุญ`);
                
            } catch (error) {
                console.error('โ ุฎุทุฃ ูู ุญุฐู ุงูุฅุดุนุงุฑุงุช ุงููุญุฏุฏุฉ:', error);
                showError('ูุดู ุญุฐู ุงูุฅุดุนุงุฑุงุช: ' + error.message);
                showLoading(false);
            }
        }

        // ุนุฑุถ ููุฏุงู ุญุฐู ุฌููุน ุงูุฅุดุนุงุฑุงุช
        function showDeleteAllModal() {
            if (allNotifications.length === 0) {
                showInfo('ูุง ุชูุฌุฏ ุฅุดุนุงุฑุงุช ููุญุฐู');
                return;
            }
            
            const deleteAllModal = new bootstrap.Modal(document.getElementById('deleteAllModal'));
            deleteAllModal.show();
        }

        // ุญุฐู ุฌููุน ุงูุฅุดุนุงุฑุงุช
        async function deleteAllNotifications() {
            try {
                if (!db) throw new Error('ูุงุนุฏุฉ ุงูุจูุงูุงุช ุบูุฑ ูุชุงุญุฉ');
                
                // ุฅุบูุงู ุงูููุฏุงู
                const deleteAllModal = bootstrap.Modal.getInstance(document.getElementById('deleteAllModal'));
                deleteAllModal.hide();
                
                showLoading(true);
                
                // ุญุฐู ูู Firebase
                const snapshot = await db.collection('notifications').get();
                const batch = db.batch();
                
                snapshot.forEach(doc => {
                    batch.delete(doc.ref);
                });
                
                await batch.commit();
                
                // ุชุญุฏูุซ ูุญููุงู
                allNotifications = [];
                filteredNotifications = [];
                selectedNotifications.clear();
                
                // ุชุญุฏูุซ ุงููุงุฌูุฉ
                renderNotifications();
                updateStatistics();
                
                showLoading(false);
                showSuccess('ุชู ุญุฐู ุฌููุน ุงูุฅุดุนุงุฑุงุช ุจูุฌุงุญ');
                
            } catch (error) {
                console.error('โ ุฎุทุฃ ูู ุญุฐู ุฌููุน ุงูุฅุดุนุงุฑุงุช:', error);
                showError('ูุดู ุญุฐู ุงูุฅุดุนุงุฑุงุช: ' + error.message);
                showLoading(false);
            }
        }

        // ุชุญุฏูุฏ ุงูุฅุดุนุงุฑุงุช ุงููุญุฏุฏุฉ ูููุฑูุกุฉ
        async function markSelectedAsRead() {
            if (selectedNotifications.size === 0) {
                showInfo('ูู ูุชู ุชุญุฏูุฏ ุฃู ุฅุดุนุงุฑุงุช');
                return;
            }
            
            try {
                if (!db) throw new Error('ูุงุนุฏุฉ ุงูุจูุงูุงุช ุบูุฑ ูุชุงุญุฉ');
                
                const batch = db.batch();
                selectedNotifications.forEach(notificationId => {
                    const ref = db.collection('notifications').doc(notificationId);
                    batch.update(ref, {
                        isRead: true,
                        readAt: new Date()
                    });
                });
                
                await batch.commit();
                
                // ุชุญุฏูุซ ูุญููุงู
                allNotifications.forEach(notification => {
                    if (selectedNotifications.has(notification.id)) {
                        notification.isRead = true;
                    }
                });
                
                renderNotifications();
                updateStatistics();
                
                showSuccess(`ุชู ุชุญุฏูุฏ ${selectedNotifications.size} ุฅุดุนุงุฑ ูููุฑูุก`);
                
            } catch (error) {
                console.error('โ ุฎุทุฃ ูู ุชุญุฏูุซ ุงูุฅุดุนุงุฑุงุช:', error);
                showError('ูุดู ุชุญุฏูุซ ุงูุฅุดุนุงุฑุงุช');
            }
        }

        // ุชุญุฏูุฏ ุงูุฅุดุนุงุฑุงุช ุงููุญุฏุฏุฉ ูุบูุฑ ููุฑูุกุฉ
        async function markSelectedAsUnread() {
            if (selectedNotifications.size === 0) {
                showInfo('ูู ูุชู ุชุญุฏูุฏ ุฃู ุฅุดุนุงุฑุงุช');
                return;
            }
            
            try {
                if (!db) throw new Error('ูุงุนุฏุฉ ุงูุจูุงูุงุช ุบูุฑ ูุชุงุญุฉ');
                
                const batch = db.batch();
                selectedNotifications.forEach(notificationId => {
                    const ref = db.collection('notifications').doc(notificationId);
                    batch.update(ref, {
                        isRead: false,
                        readAt: null
                    });
                });
                
                await batch.commit();
                
                // ุชุญุฏูุซ ูุญููุงู
                allNotifications.forEach(notification => {
                    if (selectedNotifications.has(notification.id)) {
                        notification.isRead = false;
                    }
                });
                
                renderNotifications();
                updateStatistics();
                
                showSuccess(`ุชู ุชุญุฏูุฏ ${selectedNotifications.size} ุฅุดุนุงุฑ ูุบูุฑ ููุฑูุก`);
                
            } catch (error) {
                console.error('โ ุฎุทุฃ ูู ุชุญุฏูุซ ุงูุฅุดุนุงุฑุงุช:', error);
                showError('ูุดู ุชุญุฏูุซ ุงูุฅุดุนุงุฑุงุช');
            }
        }

        // ุชูุนูู ุงูุฅุดุนุงุฑุงุช ุงููุญุฏุฏุฉ
        async function activateSelected() {
            if (selectedNotifications.size === 0) {
                showInfo('ูู ูุชู ุชุญุฏูุฏ ุฃู ุฅุดุนุงุฑุงุช');
                return;
            }
            
            try {
                if (!db) throw new Error('ูุงุนุฏุฉ ุงูุจูุงูุงุช ุบูุฑ ูุชุงุญุฉ');
                
                const batch = db.batch();
                selectedNotifications.forEach(notificationId => {
                    const ref = db.collection('notifications').doc(notificationId);
                    batch.update(ref, {
                        isActive: true
                    });
                });
                
                await batch.commit();
                
                // ุชุญุฏูุซ ูุญููุงู
                allNotifications.forEach(notification => {
                    if (selectedNotifications.has(notification.id)) {
                        notification.isActive = true;
                    }
                });
                
                renderNotifications();
                updateStatistics();
                
                showSuccess(`ุชู ุชูุนูู ${selectedNotifications.size} ุฅุดุนุงุฑ`);
                
            } catch (error) {
                console.error('โ ุฎุทุฃ ูู ุชุญุฏูุซ ุงูุฅุดุนุงุฑุงุช:', error);
                showError('ูุดู ุชุญุฏูุซ ุงูุฅุดุนุงุฑุงุช');
            }
        }

        // ุชุนุทูู ุงูุฅุดุนุงุฑุงุช ุงููุญุฏุฏุฉ
        async function deactivateSelected() {
            if (selectedNotifications.size === 0) {
                showInfo('ูู ูุชู ุชุญุฏูุฏ ุฃู ุฅุดุนุงุฑุงุช');
                return;
            }
            
            try {
                if (!db) throw new Error('ูุงุนุฏุฉ ุงูุจูุงูุงุช ุบูุฑ ูุชุงุญุฉ');
                
                const batch = db.batch();
                selectedNotifications.forEach(notificationId => {
                    const ref = db.collection('notifications').doc(notificationId);
                    batch.update(ref, {
                        isActive: false
                    });
                });
                
                await batch.commit();
                
                // ุชุญุฏูุซ ูุญููุงู
                allNotifications.forEach(notification => {
                    if (selectedNotifications.has(notification.id)) {
                        notification.isActive = false;
                    }
                });
                
                renderNotifications();
                updateStatistics();
                
                showSuccess(`ุชู ุชุนุทูู ${selectedNotifications.size} ุฅุดุนุงุฑ`);
                
            } catch (error) {
                console.error('โ ุฎุทุฃ ูู ุชุญุฏูุซ ุงูุฅุดุนุงุฑุงุช:', error);
                showError('ูุดู ุชุญุฏูุซ ุงูุฅุดุนุงุฑุงุช');
            }
        }

        // ุชุญุฏูุฏ ุฌููุน ุงูุฅุดุนุงุฑุงุช ูููุฑูุกุฉ
        async function markAllAsRead() {
            try {
                if (!db) return;
                
                const unreadNotifications = allNotifications.filter(n => !n.isRead);
                
                if (unreadNotifications.length === 0) {
                    showInfo('ูุง ุชูุฌุฏ ุฅุดุนุงุฑุงุช ุบูุฑ ููุฑูุกุฉ');
                    return;
                }
                
                if (!confirm(`ูู ุชุฑูุฏ ุชุญุฏูุฏ ${unreadNotifications.length} ุฅุดุนุงุฑ ูููุฑูุกุ`)) return;
                
                showLoading(true);
                
                const batch = db.batch();
                unreadNotifications.forEach(notification => {
                    const ref = db.collection('notifications').doc(notification.id);
                    batch.update(ref, {
                        isRead: true,
                        readAt: new Date()
                    });
                });
                
                await batch.commit();
                
                // ุชุญุฏูุซ ูุญููุงู
                unreadNotifications.forEach(n => n.isRead = true);
                
                renderNotifications();
                updateStatistics();
                
                showLoading(false);
                showSuccess('ุชู ุชุญุฏูุฏ ุฌููุน ุงูุฅุดุนุงุฑุงุช ูููุฑูุกุฉ ุจูุฌุงุญ');
                
            } catch (error) {
                console.error('โ ุฎุทุฃ ูู ุชุญุฏูุซ ุงูุฅุดุนุงุฑุงุช:', error);
                showError('ูุดู ุชุญุฏูุซ ุงูุฅุดุนุงุฑุงุช');
                showLoading(false);
            }
        }

        // ุชุตุฏูุฑ ุงูุฅุดุนุงุฑุงุช
        async function exportNotifications() {
            try {
                const data = {
                    notifications: allNotifications,
                    exportedAt: new Date(),
                    total: allNotifications.length,
                    version: '1.0'
                };

                const dataStr = JSON.stringify(data, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                
                const url = URL.createObjectURL(dataBlob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `notifications-backup-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showSuccess('ุชู ุชุตุฏูุฑ ุงูุฅุดุนุงุฑุงุช ุจูุฌุงุญ');
                
            } catch (error) {
                console.error('โ ูุดู ุชุตุฏูุฑ ุงูุฅุดุนุงุฑุงุช:', error);
                showError('ูุดู ุชุตุฏูุฑ ุงูุฅุดุนุงุฑุงุช');
            }
        }

        // ุนุฑุถ ุฑุณุงุฆู ุงูุญุงูุฉ
        function showMessage(message, type) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show mt-3`;
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            const container = document.querySelector('.admin-container');
            if (container) {
                container.insertBefore(alertDiv, container.firstChild);
            }
            
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.remove();
                }
            }, 5000);
        }

        function showSuccess(message) {
            showMessage(`โ ${message}`, 'success');
        }

        function showError(message) {
            showMessage(`โ ${message}`, 'danger');
        }

        function showInfo(message) {
            showMessage(`โน๏ธ ${message}`, 'info');
        }

        // ุชููุฆุฉ ุงูุตูุญุฉ ุนูุฏ ุงูุชุญููู
        document.addEventListener('DOMContentLoaded', checkAdminAuth);
    </script>
</body>
</html>
